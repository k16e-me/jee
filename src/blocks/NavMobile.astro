---
import Grid from '@layouts/Grid.astro'
import Wrapper from '@layouts/Wrapper.astro'
import TitleHidden from './TitleHidden.astro'
import { _settings } from '@scripts/store'
import NavItemMobile from '@atoms/NavItemMobile.astro'
import Text from '@atoms/Text.astro'
import Icon from '@atoms/Icon.astro'
import NavMobileLink from '@atoms/NavMobileLink.astro'
import _empty from '@scripts/empty'
import _slug from '@scripts/slug'

const { class: classes, ...props } = Astro.props,
	nav = _settings.value.nav,
	hub = _settings.value.tools[2]
---

<Wrapper tag='nav' class="py-4 sm:py-8">
	<TitleHidden tag='h2' title={'Mobile Navigation'} />
	<Grid grid='4-12-12'>
		<ul
			class:list={[
				'col-span-full sm:[grid-area:1/3/2/11] items-center h-full [&>*]:border-t [&>*]:border-[var(--color-muted-dark)] [&>*:first-child]:border-t-0',
				classes,
			]}
			{...props}>
			{
				nav.map((i) =>
					_empty(i.children) ? (
						<li class:list={['group/li relative']}>
							<NavItemMobile
								href={_slug(i.link)}
								label={i.label}
							/>
						</li>
					) : (
						<li class:list={['group/li relative']}>
							<NavItemMobile label={i.label} />
						</li>
					),
				)
			}
			<li
				class='accordion group px-4 [&.is-active]:bg-[var(--color-elevation-1-inverted)]'>
				<div
					class='group/button accordion__button r-transition flex items-center justify-between h-14 lg:h-10 cursor-pointer lg:cursor-default'
					aria-expanded='false'
					aria-controls={`${hub.label} Links`}>
					<Text
						text={hub.label}
						size='5'
						color='title-light'
						weight='bold'
						class='opacity-100 group-hover/button:opacity-70 group-[.is-active]:opacity-100 pointer-events-none'
					/>
					<Icon
						name='caret-down'
						aria-hidden='true'
						class='accordion__icon block w-5 text-[var(--color-lightest)] opacity-50 group-hover/button:opacity-100 shrink-0 transition-all group-[.is-active]:opacity-100'
					/>
				</div>
				<div
					class='accordion__content max-h-0 lg:max-h-full overflow-hidden lg:overflow-auto transition-all ease-in-out'>
					<ul
						class='px-4 flex flex-col max-w-full transition-[height] duration-[250ms]'>
						{
							hub.children.map((i) => (
								<li class='group/link flex items-center p-4 w-full'>
									<NavMobileLink link={i} />
								</li>
							))
						}
					</ul>
				</div>
			</li>
		</ul>
	</Grid>
</Wrapper>
